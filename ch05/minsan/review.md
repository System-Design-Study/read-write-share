`모듈러 연산 해시 키 생성 방식`의 가장 큰 취약점은 **해시 키 재배치**의 발생을 예방하기 어렵다는 것이다.

- 해시 함수 자체가 서버 개수에 의존하는 형태 _(key % 서버 개수 N)_
- 따라서 특정 서버가 다운되거나 서버가 새로 추가되는 경우 재배치가 불가피

이러한 모듈러 연산 함수를 적용하는 방식의 문제점을 명확하게 이해하고, 이를 `안정 해시`에서는 어떻게 해결하고 있는지를 중점으로 내용을 이해하고 있으면 좋을 것 같다.

# 안정 해시는 재배치되는 키의 개수를 낮출 수 있다

**고전적인 방식**에서는 서버가 추가되거나 삭제될 때마다 거의 모든 키가 재배치 되어야 한다.

하지만 **안정 해시 방식**은 `추가 / 삭제된 서버`와 해당 위치에서 `반시계 방향으로 가장 가까운 서버` 사이에 존재하는 키만 재배치하면 된다. _(= 약 `k/n개`)_

> 👉🏻 기존 방식과 마찬가지로 서버 개수에 변동이 발생할 때 키를 재배치하는 것이 불가피하지만, **재배치 해야하는 키의 개수를 대폭 줄일 수 있다**는 점에서 의미가 크다.

# 가상 노드로 서버 균등 배치의 한계를 개선할 수 있다

안정 해시에서 해시 링 위에 배치되는 서버는 균등하게 배치되어야 한다.

- 특정 구간에 서버가 몰려있는 경우, 해당 구간과 멀리 떨어진 키 값은 서버를 탐색하는 데 더 오랜 시간이 걸리기 때문 _(시계 방향 순차탐색)_
- 특정 서버에 저장되는 키 값의 개수가 몰릴 수 있기 때문

하지만 현실적으로, 서버의 추가 / 삭제가 발생할 수 있는 상황에서 서버 간의 거리를 균등하게 유지하는 것은 쉽지 않은 일이다.

이 문제를 해결하기 위해 등장한 개념이 `가상 노드`이다.

- 가상 노드를 사용하면 마치 하나의 서버를 복제해서 여러 곳에 배치한 것과 같은 효과를 주기 때문에, 키 값을 균등하게 배치할 수 있다.
  - 다만, 그만큼 **추가 저장공간**이 필요하므로 적절한 선택이 필요함 _(트레이드오프)_

> 이처럼 `해시 링`에서 발생 가능한 문제점을 이해하고, `가상 노드`가 이를 어떻게 해결하는지 이해하고 있는 것이 중요할 것 같다.

# 안정 해시의 장점

1. 서버가 추가되거나 삭제될 때, 재배치되는 키의 수가 최소화 된다.
2. 데이터가 보다 균등하게 분포되어, 수평적 규모 확장성을 달성하기 쉽다.
3. 핫스팟 키 문제를 줄일 수 있다. _(= 2번의 연장선)_
