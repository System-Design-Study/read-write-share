# 02 장 : 개략적인 규모 측정

시스템 설계 면접을 볼 때, 때로는 시스템 용량이나 성능 요구사항을 개략적으로 추정해 보라는 요구를 받게 된다. 구글의 시니어 펠로 제프딘에 따르면, "개략적인 규모 추정(bakc-of-the-envelope estimatiuon)은 보편적으로 통용되는 성능 수치상에서 사고 실험(thought experiments)을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것"이다.

개략적 규모 추정을 효과적으로 해 내려면 규모 확장성을 표현하는 데 필요한 기본기에 능숙해야 한다. 특히, 2의 제곱수나 응답지연(latency) 값, 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다.

# 2의 제곱수


### 데이터 볼륨 단위 표

다음은 분산 시스템에서 다루는 데이터 양을 2의 제곱수로 표현한 데이터 볼륨 단위 표이다. 기본 단위는 바이트(Byte)이며, ASCII 문자 하나가 차지하는 메모리 크기는 1바이트이다.

| 2의 제곱수 | 근사치                                     | 이름        | 축약형 |
| ------ | --------------------------------------- | --------- | --- |
| 2⁰     | 1 Byte                                  | Byte      | B   |
| 2¹⁰    | 1,024 Bytes                             | Kilobyte  | KB  |
| 2²⁰    | 1,048,576 Bytes                         | Megabyte  | MB  |
| 2³⁰    | 1,073,741,824 Bytes                     | Gigabyte  | GB  |
| 2⁴⁰    | 1,099,511,627,776 Bytes                 | Terabyte  | TB  |
| 2⁵⁰    | 1,125,899,906,842,624 Bytes             | Petabyte  | PB  |
| 2⁶⁰    | 1,152,921,504,606,846,976 Bytes         | Exabyte   | EB  |
| 2⁷⁰    | 1,180,591,620,717,411,303,424 Bytes     | Zettabyte | ZB  |
| 2⁸⁰    | 1,208,925,819,614,629,174,706,176 Bytes | Yottabyte | YB  |

# 모든 프로그래머가 알야아 하는 응답지연 값

구글의 제프 딘은 2010년에 통상적인 컴퓨터에서 구현된 연산들의 응답지연 값을 공개한 바 있다. 이들 가운데 몇몇은 더 빠른 컴퓨터가 등장하면서 더 이상 유효하지 않게 되었지만, 아직도 이 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있게 해준다.

| **연산명**                                   | **시간**          |
|----------------------------------------------|-------------------|
| L1 캐시 접근                                 | 0.5 ns           |
| L2 캐시 접근                                 | 7 ns             |
| 메인 메모리 접근                            | 100 ns           |
| SSD I/O                                      | 150 µs           |
| 회전식 디스크에서 데이터 읽기                | 10 ms            |
| 1MB 데이터를 메모리 내에서 순차적으로 읽기   | 250 µs           |
| 1MB 데이터를 SSD에서 순차적으로 읽기         | 1 ms             |
| 1MB 데이터를 네트워크를 통해 전송            | 10 ms            |
| 1MB 데이터를 회전식 디스크에서 순차적으로 읽기| 30 ms            |
| 데이터센터 내에서 네트워크 왕복(RTT)         | 500 µs           |
| 데이터센터 간 네트워크 왕복(RTT)             | 150 ms           |

---

### 참고 사항
- **ns (나노초)**: 1초의 10억분의 1  
- **µs (마이크로초)**: 1초의 100만분의 1  
- **ms (밀리초)**: 1초의 1,000분의 1  

제시된 수치들을 분석하면 다음과 같은 결론이 나온다.

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역(region)에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

# 가용성에 관계된 수치들

고가용성(high availability)은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어다. 고가용성을 표현하는 값은 퍼센트(percent)로 표현하는데, 100%는 시스템이 단 한번도 중단된 적이 없었음을 의미한다. 대부분의 서비스는 99% 에서 100% 사이의 값을 갖는다.

SLA(Service Level Agreement)는 서비스 사업자(service provider)가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미한다. 이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술되어 있다. 아마존, 구글, 그리고 마이크로소프트 같은 사업자는 99%이상의 SLA를 제공한다. 가용시간은 관습적으로 숫자 9를 사용해 표시한다. 9가 많으면 많을수록 좋다고 보면 된다.

# 예제 : 트위터 QPS 와 저장소 요구량 추정

가정
- 월간 능동 사용자(MAU)는 3억(300million) 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관된다.

추정
QPS(Query Per Second) 추정치
- 일간 능동 사용자(DAU) = 3억 X 50 % = 1.5억(150million)
- QPS = 1.5억 X 2 트윗 / 24시간/ 3600초 = 약 3500
- 최대 QPS(Peek QPS) = 2 x QPS  = 약 7000

미디어 저장을 위한 저장소 요구량
- 평균 트윗 크기
	- tweet_id에 64 바이트
	- 텍스트에 140바이트
	- 미디어에 1MB
- 미디어 저장소 요구량: 1.5억 X 2 X 10% x 1 MB = 30 TB /일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB X 365  5 = 약 55PB

# 팁

개략적인 구모 추정과 관계된 면접에서 가장 중요한 것은 문제를 풀어 나가는 절차다. 올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다. 면접자가 보고 싶어 하는 것은 여러분의 문제 해결 능력일 것이다. 

- 근사치를 활용한 계산(rounding and approximation): 면접장에서 복잡한 계산을 하는 것은 어려운 일이다. 이런 데 시간을 쓰는 것은 낭비다. 계산 결과의 정확함을 평가하는 것이 목적이 아니라서다. 그러니 적절히 근사치를 활용하여 시간을 절약하다.
- 가정(assumption)들은 적어 두라. 나중에 살펴볼 수 있도록
- 단위(unit)를 붙이라. 5라고만 적으면 5KB인지 5MB인지 알 수가 없다. 나중에는 여러분 스스로도 헷갈리게 될 것이다. 단위를 붙이는 습관을 들여두면 모호함을 방지할 수 있다.
- 많이 출제되느 개략적 규모 추정 문제 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다. 면접에 임하기 전에 이런 값들을 계산하는 연습을 미리 하도록하자. 완벽함을 달성하는 방법은 연습뿐이다.

